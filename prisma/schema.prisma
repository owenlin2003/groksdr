// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Lead {
  id          String   @id @default(cuid())
  name        String
  email       String
  company     String
  score       Int?     @default(0)
  stage       String   @default("New")
  notes       String?
  metadata    String?  // JSON string for additional data
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  activities Activity[]
  
  @@index([stage])
  @@index([score])
}

model PipelineStage {
  id          String   @id @default(cuid())
  name        String   @unique
  order       Int      @default(0)
  description String?
  createdAt   DateTime @default(now())
}

model Activity {
  id          String   @id @default(cuid())
  leadId      String
  type        String   // qualification, message, stage_change, score_update, note
  description String
  timestamp   DateTime @default(now())
  grokResponse String? // JSON string of Grok response
  modelUsed   String?  // grok-3, grok-4-fast-reasoning, etc.
  input       String?  // JSON string of input data
  output      String?  // JSON string of output data
  userTriggered String? // user identifier
  
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  @@index([leadId])
  @@index([timestamp])
  @@index([type])
}

model EvaluationResult {
  id              String   @id @default(cuid())
  modelVariant    String   // grok-3, grok-4-fast-reasoning, grok-4-fast-non-reasoning
  leadId          String?  // Reference to test lead
  responseTime    Float    // milliseconds
  score           Int?
  scoreConsistency Float?  // variance measure
  responseQuality String?  // JSON string with quality metrics
  createdAt       DateTime @default(now())
  
  @@index([modelVariant])
  @@index([createdAt])
}

model ScoringCriteria {
  id                  String   @id @default(cuid())
  userId              String?  // For multi-user support (optional for now)
  companySizeWeight   Float    @default(1.0)
  industryMatchWeight Float    @default(1.0)
  budgetSignalsWeight Float    @default(1.0)
  decisionMakerWeight Float    @default(1.0)
  isDefault           Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([userId])
}

